<h2 mat-dialog-title>{{ data.historial ? 'Editar' : 'Nuevo' }} Registro de Historial Clínico</h2>

<mat-dialog-content>
  <form [formGroup]="registroForm" class="form-container">

    <div class="form-row">
      <app-patient-selector 
        class="form-field patient-selector"
        [control]="registroForm.get('idPaciente')!"
        [initialPatientId]="data.historial?.idPaciente"
        (patientSelected)="onPacienteSelected($event)">
      </app-patient-selector>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Diagnóstico</mat-label>
        <textarea matInput formControlName="diagnostico" rows="3"></textarea>
        <mat-error *ngIf="registroForm.get('diagnostico')?.hasError('required')">
          El diagnóstico es requerido
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Tratamiento</mat-label>
        <textarea matInput formControlName="tratamiento" rows="3"></textarea>
        <mat-error *ngIf="registroForm.get('tratamiento')?.hasError('required')">
          El tratamiento es requerido
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Observaciones</mat-label>
        <textarea matInput formControlName="observaciones" rows="3"></textarea>
      </mat-form-field>

      <div class="form-field">
        <mat-checkbox formControlName="seguimientoRequerido">
          Seguimiento Requerido
        </mat-checkbox>
      </div>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="dialogRef.close()">Cancelar</button>
  <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="!registroForm.valid">
    {{ data.historial ? 'Actualizar' : 'Guardar' }}
  </button>
</mat-dialog-actions>

<style>
.form-container {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.form-row {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.form-field {
  width: 100%;
}
</style> 